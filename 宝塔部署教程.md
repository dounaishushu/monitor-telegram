# ğŸ¤– Telegram ç¾¤ç›‘å¬æœºå™¨äºº - å®å¡”éƒ¨ç½²æ•™ç¨‹

---

## ğŸ“‹ ä¸€ã€ç¯å¢ƒè¦æ±‚

| é¡¹ç›® | è¦æ±‚ |
|------|------|
| æœåŠ¡å™¨ | **å¢ƒå¤–æœåŠ¡å™¨**ï¼ˆé¦™æ¸¯/æ–°åŠ å¡/ç¾å›½ç­‰ï¼Œå¿…é¡»èƒ½è®¿é—® Telegramï¼‰ |
| ç³»ç»Ÿ | CentOS 7+ / Ubuntu 18+ |
| å®å¡”ç‰ˆæœ¬ | 7.0+ |
| Python | 3.8+ |
| å†…å­˜ | 1GB+ |

> âš ï¸ **é‡è¦æç¤º**ï¼šå›½å†…æœåŠ¡å™¨æ— æ³•ç›´æ¥è®¿é—® Telegramï¼Œå¿…é¡»ä½¿ç”¨å¢ƒå¤–æœåŠ¡å™¨ï¼

---

## ğŸš€ äºŒã€éƒ¨ç½²æ­¥éª¤

### æ­¥éª¤ 1ï¼šå®‰è£… Python ç¯å¢ƒ

1. ç™»å½•å®å¡”é¢æ¿
2. è¿›å…¥ **è½¯ä»¶å•†åº—** â†’ æœç´¢ **Pythoné¡¹ç›®ç®¡ç†å™¨ 2.0**
3. ç‚¹å‡» **å®‰è£…**

---

### æ­¥éª¤ 2ï¼šä¸Šä¼ é¡¹ç›®æ–‡ä»¶

1. è¿›å…¥å®å¡” **æ–‡ä»¶ç®¡ç†**
2. è¿›å…¥ `/www/wwwroot/` ç›®å½•
3. ç‚¹å‡» **æ–°å»ºç›®å½•**ï¼Œåˆ›å»º `tg_monitor_bot`
4. è¿›å…¥è¯¥ç›®å½•ï¼Œç‚¹å‡» **ä¸Šä¼ **ï¼Œä¸Šä¼ æ‰€æœ‰é¡¹ç›®æ–‡ä»¶


**ä¸Šä¼ åç›®å½•ç»“æ„ï¼š**
```
/www/wwwroot/tg_monitor_bot/
â”œâ”€â”€ main.py              # ä¸»ç¨‹åº
â”œâ”€â”€ database.py          # æ•°æ®åº“æ¨¡å—
â”œâ”€â”€ listener_client.py   # ç›‘å¬è€…å®¢æˆ·ç«¯
â”œâ”€â”€ config.example.py    # é…ç½®ç¤ºä¾‹
â”œâ”€â”€ requirements.txt     # ä¾èµ–åˆ—è¡¨
â”œâ”€â”€ start.sh             # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ handlers/            # å¤„ç†å™¨æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ keyword_handlers.py
â”‚   â”œâ”€â”€ group_handlers.py
â”‚   â””â”€â”€ admin_handlers.py
â””â”€â”€ data/                # æ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨åˆ›å»ºï¼‰
    â”œâ”€â”€ bot.db           # æ•°æ®åº“æ–‡ä»¶
    â”œâ”€â”€ bot.log          # æ—¥å¿—æ–‡ä»¶
    â””â”€â”€ listener.session # ç›‘å¬è€…ç™»å½•å‡­è¯
```

---

### æ­¥éª¤ 3ï¼šé…ç½®æœºå™¨äºº

#### 3.1 åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
cd /www/wwwroot/tg_monitor_bot
cp config.example.py config.py
```

#### 3.2 ç¼–è¾‘é…ç½®æ–‡ä»¶

ä½¿ç”¨å®å¡”æ–‡ä»¶ç®¡ç†å™¨ç¼–è¾‘ `config.py`ï¼š

```python
# -*- coding: utf-8 -*-

# ========== æœºå™¨äººé…ç½® ==========
# ä» @BotFather åˆ›å»ºæœºå™¨äººè·å–
BOT_TOKEN = "7691989968:AAHpnEpsdt_m8ZbdzDyu9Npw72jMl48Ce0"

# è¶…çº§ç®¡ç†å‘˜ID (ä» @userinfobot è·å–)
SUPER_ADMINS = [
    123456789,  # æ›¿æ¢ä¸ºä½ çš„ç”¨æˆ·ID
]

# ========== ç›‘å¬è€…è´¦å·é…ç½® ==========
# ä» https://my.telegram.org è·å–
API_ID = 12345678           # ä½ çš„ API ID
API_HASH = "your_api_hash"  # ä½ çš„ API Hash

# ç›‘å¬è€…æ‰‹æœºå·ï¼ˆå¸¦å›½é™…åŒºå·ï¼‰
LISTENER_PHONE = "+8613812345678"

# Session æ–‡ä»¶è·¯å¾„
SESSION_PATH = "data/listener.session"

# æ•°æ®åº“è·¯å¾„
DATABASE_PATH = "data/bot.db"

# æ—¥å¿—é…ç½®
LOG_LEVEL = "INFO"
LOG_FILE = "data/bot.log"
```

---

### æ­¥éª¤ 4ï¼šå®‰è£…ä¾èµ–

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨å®å¡” Python ç®¡ç†å™¨

1. æ‰“å¼€ **Pythoné¡¹ç›®ç®¡ç†å™¨ 2.0**
2. ç‚¹å‡» **ç‰ˆæœ¬ç®¡ç†** â†’ é€‰æ‹© Python 3.10+
3. ç‚¹å‡» **å®‰è£…**

#### æ–¹æ³•äºŒï¼šSSH å‘½ä»¤å®‰è£…

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/tg_monitor_bot

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# å‡çº§ pip
pip install --upgrade pip

# å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿï¼‰
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

**ä¾èµ–åˆ—è¡¨ï¼š**
```
python-telegram-bot==20.7
aiosqlite==0.19.0
python-dotenv==1.0.0
Telethon==1.34.0
cryptg==0.4.0
```

---

### æ­¥éª¤ 5ï¼šåˆ›å»ºæ•°æ®ç›®å½•

```bash
mkdir -p /www/wwwroot/tg_monitor_bot/data
chmod 755 /www/wwwroot/tg_monitor_bot/data
```

---

### æ­¥éª¤ 6ï¼šå¯åŠ¨æœºå™¨äºº

#### æ–¹æ³•ä¸€ï¼šç›´æ¥è¿è¡Œï¼ˆæµ‹è¯•ç”¨ï¼‰

```bash
cd /www/wwwroot/tg_monitor_bot
source venv/bin/activate
python main.py
```

çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—è¯´æ˜å¯åŠ¨æˆåŠŸï¼š
```
ğŸš€ æœºå™¨äººå¯åŠ¨ä¸­...
æœºå™¨äººåˆå§‹åŒ–å®Œæˆ
```

#### æ–¹æ³•äºŒï¼šåå°è¿è¡Œï¼ˆæ¨èï¼‰

```bash
cd /www/wwwroot/tg_monitor_bot
source venv/bin/activate
nohup python main.py > data/output.log 2>&1 &
```

---

## ğŸ”„ ä¸‰ã€è¿›ç¨‹å®ˆæŠ¤ï¼ˆä¿æŒè¿è¡Œï¼‰

### æ¨èæ–¹å¼ï¼šä½¿ç”¨ Supervisor

#### 1. å®‰è£… Supervisor

```bash
# CentOS
yum install supervisor -y

# Ubuntu
apt install supervisor -y

# å¯åŠ¨æœåŠ¡
systemctl enable supervisord
systemctl start supervisord
```

#### 2. åˆ›å»ºé…ç½®æ–‡ä»¶

```bash
nano /etc/supervisord.d/tg_bot.ini
```

å¡«å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[program:tg_monitor_bot]
command=/www/wwwroot/tg_monitor_bot/venv/bin/python /www/wwwroot/tg_monitor_bot/main.py
directory=/www/wwwroot/tg_monitor_bot
user=root
autostart=true
autorestart=true
startsecs=5
startretries=3
redirect_stderr=true
stdout_logfile=/www/wwwroot/tg_monitor_bot/data/supervisor.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=3
```

#### 3. å¯åŠ¨è¿›ç¨‹

```bash
supervisorctl reread
supervisorctl update
supervisorctl start tg_monitor_bot
```

#### 4. å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
supervisorctl status tg_monitor_bot

# é‡å¯
supervisorctl restart tg_monitor_bot

# åœæ­¢
supervisorctl stop tg_monitor_bot

# æŸ¥çœ‹æ—¥å¿—
tail -f /www/wwwroot/tg_monitor_bot/data/supervisor.log
```

---

## ğŸ“± å››ã€ç™»å½•ç›‘å¬è€…è´¦å·

æœºå™¨äººå¯åŠ¨åï¼Œéœ€è¦ç™»å½•ç›‘å¬è€…è´¦å·æ‰èƒ½ç›‘å¬ç¾¤æ¶ˆæ¯ï¼š

1. åœ¨ Telegram ä¸­æ‰¾åˆ°ä½ çš„æœºå™¨äºº
2. å‘é€ `/start`
3. ç‚¹å‡» **ğŸ‘¤ ç›‘å¬è€…è®¾ç½®**
4. ç‚¹å‡» **ğŸ“² å‘é€éªŒè¯ç **
5. è¾“å…¥æ”¶åˆ°çš„éªŒè¯ç 
6. å¦‚æœ‰ä¸¤æ­¥éªŒè¯ï¼Œè¾“å…¥å¯†ç 
7. ç™»å½•æˆåŠŸåï¼Œç‚¹å‡» **ğŸ”„ åŒæ­¥ç¾¤ç»„**
8. ç‚¹å‡» **ğŸ”Š å¼€å§‹ç›‘å¬**

---

## ğŸ“Š äº”ã€å¸¸ç”¨è¿ç»´å‘½ä»¤

### æŸ¥çœ‹è¿›ç¨‹

```bash
ps aux | grep main.py
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# å®æ—¶æŸ¥çœ‹æ—¥å¿—
tail -f /www/wwwroot/tg_monitor_bot/data/bot.log

# æŸ¥çœ‹æœ€è¿‘100è¡Œ
tail -n 100 /www/wwwroot/tg_monitor_bot/data/bot.log
```

### é‡å¯æœºå™¨äºº

```bash
# ä½¿ç”¨ Supervisor
supervisorctl restart tg_monitor_bot

# æˆ–æ‰‹åŠ¨é‡å¯
pkill -f "python.*main.py"
cd /www/wwwroot/tg_monitor_bot
source venv/bin/activate
nohup python main.py > data/output.log 2>&1 &
```

### å¤‡ä»½æ•°æ®åº“

```bash
cp /www/wwwroot/tg_monitor_bot/data/bot.db /å¤‡ä»½ç›®å½•/bot_$(date +%Y%m%d).db
```

---

## â“ å…­ã€å¸¸è§é—®é¢˜

### Q1: æœºå™¨äººæ— æ³•å¯åŠ¨

**æ£€æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥ `config.py` æ˜¯å¦å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
2. æ£€æŸ¥ BOT_TOKEN æ˜¯å¦æœ‰æ•ˆ
3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æ’æŸ¥é”™è¯¯

```bash
cat /www/wwwroot/tg_monitor_bot/data/bot.log
```

### Q2: æ— æ³•è¿æ¥ Telegram

**åŸå› ï¼š** æœåŠ¡å™¨åœ¨å›½å†…ï¼Œæ— æ³•è®¿é—® Telegram API

**è§£å†³ï¼š** ä½¿ç”¨å¢ƒå¤–æœåŠ¡å™¨ï¼ˆé¦™æ¸¯/æ–°åŠ å¡/ç¾å›½ç­‰ï¼‰

### Q3: ä¾èµ–å®‰è£…å¤±è´¥

```bash
# ä½¿ç”¨å›½å†…é•œåƒ
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# å¦‚æœè¿˜æ˜¯å¤±è´¥ï¼Œå•ç‹¬å®‰è£…
pip install python-telegram-bot==20.7 -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install Telethon==1.34.0 -i https://pypi.tuna.tsinghua.edu.cn/simple
pip install aiosqlite -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q4: ç›‘å¬è€…ç™»å½•å¤±è´¥

1. ç¡®ä¿ API_ID å’Œ API_HASH æ­£ç¡®ï¼ˆä» https://my.telegram.org è·å–ï¼‰
2. ç¡®ä¿æ‰‹æœºå·æ ¼å¼æ­£ç¡®ï¼ˆå¦‚ `+8613812345678`ï¼‰
3. å¦‚æœæç¤º"è¯·æ±‚è¿‡äºé¢‘ç¹"ï¼Œç­‰å¾…å‡ åˆ†é’Ÿåé‡è¯•

### Q5: å…³é”®è¯ç›‘å¬ä¸å·¥ä½œ

1. ç¡®ä¿ç›‘å¬è€…å·²ç™»å½•å¹¶å¼€å§‹ç›‘å¬
2. ç¡®ä¿ç›‘å¬è€…è´¦å·å·²åŠ å…¥ç›®æ ‡ç¾¤ç»„
3. æ£€æŸ¥ç¾¤ç»„æ˜¯å¦åœ¨ç›‘å¬åˆ—è¡¨ä¸­
4. æ£€æŸ¥å…³é”®è¯æ˜¯å¦å·²æ·»åŠ 

### Q6: å¦‚ä½•æ›´æ–°ä»£ç 

```bash
# åœæ­¢æœºå™¨äºº
supervisorctl stop tg_monitor_bot

# ä¸Šä¼ æ–°æ–‡ä»¶ï¼ˆè¦†ç›–æ—§æ–‡ä»¶ï¼‰

# å¯åŠ¨æœºå™¨äºº
supervisorctl start tg_monitor_bot
```

---

## ğŸ” ä¸ƒã€å®‰å…¨å»ºè®®

1. **ä¿æŠ¤é…ç½®æ–‡ä»¶**
   ```bash
   chmod 600 /www/wwwroot/tg_monitor_bot/config.py
   ```

2. **å®šæœŸå¤‡ä»½æ•°æ®**
   ```bash
   # æ·»åŠ å®šæ—¶ä»»åŠ¡
   crontab -e
   # æ¯å¤©å‡Œæ™¨3ç‚¹å¤‡ä»½
   0 3 * * * cp /www/wwwroot/tg_monitor_bot/data/bot.db /å¤‡ä»½ç›®å½•/bot_$(date +\%Y\%m\%d).db
   ```

3. **ä¿æŠ¤ Session æ–‡ä»¶**
   ```bash
   chmod 600 /www/wwwroot/tg_monitor_bot/data/listener.session
   ```

4. **å…³é—­ä¸å¿…è¦ç«¯å£**
   æœºå™¨äººä½¿ç”¨é•¿è½®è¯¢ï¼Œä¸éœ€è¦å¼€æ”¾ä»»ä½•ç«¯å£

---

## ğŸ“ å…«ã€å¿«é€Ÿå‘½ä»¤æ±‡æ€»

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /www/wwwroot/tg_monitor_bot

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate

# æ‰‹åŠ¨å¯åŠ¨ï¼ˆæµ‹è¯•ï¼‰
python main.py

# åå°å¯åŠ¨
nohup python main.py > data/output.log 2>&1 &

# åœæ­¢æœºå™¨äºº
pkill -f "python.*main.py"

# æŸ¥çœ‹æ—¥å¿—
tail -f data/bot.log

# Supervisor ç®¡ç†
supervisorctl status tg_monitor_bot
supervisorctl restart tg_monitor_bot
supervisorctl stop tg_monitor_bot
```

---

## ğŸ“ è·å–é…ç½®ä¿¡æ¯

| éœ€è¦è·å– | è·å–æ–¹å¼ |
|---------|---------|
| BOT_TOKEN | åœ¨ Telegram ä¸­æ‰¾ @BotFatherï¼Œå‘é€ /newbot åˆ›å»ºæœºå™¨äºº |
| ç”¨æˆ·ID | åœ¨ Telegram ä¸­æ‰¾ @userinfobotï¼Œå‘é€ä»»æ„æ¶ˆæ¯è·å– |
| API_ID / API_HASH | è®¿é—® https://my.telegram.org ç™»å½•ååˆ›å»ºåº”ç”¨è·å– |

---

**éƒ¨ç½²å®Œæˆåï¼Œåœ¨ Telegram ä¸­å‘æœºå™¨äººå‘é€ `/start` å¼€å§‹ä½¿ç”¨ï¼** ğŸ‰
